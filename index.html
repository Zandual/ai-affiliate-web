<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <!--
      IMPORTANT:
      - For Cloudflare Pages at the site root, "/" is OK.
      - If you deploy under a sub-path later, you may need "./"
    -->
    <base href="/" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>AI Affiliate</title>

    <!--
      Expo / react-native-web reset:
      This helps RN Web layout behave correctly.
    -->
    <style id="expo-reset">
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        overflow-x: hidden;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        /* Soft gradient background (your animation will sit on top of this) */
        background: linear-gradient(135deg, #f8fafc, #eef2ff);
      }
      #root {
        min-height: 100%;
        position: relative;
        z-index: 1; /* Keep the app ABOVE the canvas */
      }

      /* A small hint banner (non-clickable so it won't block buttons) */
      .spark-hint {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 2;
        padding: 6px 12px;
        font-size: 13px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(0, 0, 0, 0.06);
        color: rgba(0, 0, 0, 0.75);
        pointer-events: none; /* Don't block clicks on the app */
        user-select: none;
      }

      /*
        Canvas behind everything.
        pointer-events:none means your "GET DEAL" buttons remain clickable.
      */
      #spark-canvas {
        position: fixed;
        inset: 0;
        z-index: 0;
        pointer-events: none;
      }
    </style>
  </head>

  <body>
    <!-- Interactive canvas background -->
    <canvas id="spark-canvas" aria-hidden="true"></canvas>

    <!-- Small helper text (optional) -->
    <div class="spark-hint">Move your mouse ✨ click to “spark” the background</div>

    <!-- Expo mounts the app here -->
    <div id="root"></div>

    <!--
      Your bundled Expo entry script (keep this!)
      NOTE: your repo has a hashed name like AppEntry-ff4ae5....js
      Make sure the file name matches what exists in your repo.
    -->
    <script src="./AppEntry-ff4ae59a90a1b1b6314d086b5393f432.js" defer></script>

    <!--
      Interactive background script (pure JS, no libraries)
      Designed to be "safe": it won't block your app and won't touch the API calls.
    -->
    <script>
      (function () {
        "use strict";

        // Grab the canvas and context
        const canvas = document.getElementById("spark-canvas");
        const ctx = canvas.getContext("2d", { alpha: true });

        // Respect users who prefer reduced motion
        const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

        // Track size
        let w = 0;
        let h = 0;
        let dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));

        function resize() {
          w = window.innerWidth;
          h = window.innerHeight;
          dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));

          canvas.width = Math.floor(w * dpr);
          canvas.height = Math.floor(h * dpr);
          canvas.style.width = w + "px";
          canvas.style.height = h + "px";

          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }
        window.addEventListener("resize", resize, { passive: true });
        resize();

        // Particle system
        const particles = [];
        const MAX_PARTICLES = 140;

        function addSpark(x, y, count, power) {
          if (reduceMotion) return;

          for (let i = 0; i < count; i++) {
            if (particles.length >= MAX_PARTICLES) particles.shift();

            const angle = Math.random() * Math.PI * 2;
            const speed = (Math.random() * 0.8 + 0.2) * power;

            particles.push({
              x,
              y,
              vx: Math.cos(angle) * speed,
              vy: Math.sin(angle) * speed,
              r: Math.random() * 2.2 + 0.8,
              life: 1,
              decay: Math.random() * 0.02 + 0.01
            });
          }
        }

        // Mouse trail
        let lastX = w / 2;
        let lastY = h / 2;

        window.addEventListener(
          "mousemove",
          (e) => {
            lastX = e.clientX;
            lastY = e.clientY;
            addSpark(lastX, lastY, 2, 1.2);
          },
          { passive: true }
        );

        // Click burst
        window.addEventListener(
          "click",
          (e) => {
            addSpark(e.clientX, e.clientY, 28, 3.2);
          },
          { passive: true }
        );

        // Animation loop
        function tick() {
          // Clear with a slight "fade" for trail effect
          ctx.clearRect(0, 0, w, h);

          // Draw particles
          for (let i = particles.length - 1; i >= 0; i--) {
            const p = particles[i];

            p.x += p.vx;
            p.y += p.vy;
            p.vx *= 0.98;
            p.vy *= 0.98;
            p.life -= p.decay;

            if (p.life <= 0) {
              particles.splice(i, 1);
              continue;
            }

            // Soft glow dot
            ctx.globalAlpha = Math.max(0, p.life);
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(99, 102, 241, 0.55)"; /* indigo-ish */
            ctx.fill();
          }

          ctx.globalAlpha = 1;

          requestAnimationFrame(tick);
        }

        // Start
        tick();
      })();
    </script>
  </body>
</html>
